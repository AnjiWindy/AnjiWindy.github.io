<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue双向数据绑定 | Anji博客</title>
    <meta name="description" content="Welcome to my blog ">
    
    
    <link rel="preload" href="/assets/css/0.styles.f2124281.css" as="style"><link rel="preload" href="/assets/js/app.d2db35b1.js" as="script"><link rel="preload" href="/assets/js/2.3d65a9bd.js" as="script"><link rel="preload" href="/assets/js/5.838622a9.js" as="script"><link rel="prefetch" href="/assets/js/10.7e1a2abf.js"><link rel="prefetch" href="/assets/js/11.b67926d6.js"><link rel="prefetch" href="/assets/js/12.1acbb188.js"><link rel="prefetch" href="/assets/js/13.3042c592.js"><link rel="prefetch" href="/assets/js/14.35ddf8b9.js"><link rel="prefetch" href="/assets/js/15.4d8585d4.js"><link rel="prefetch" href="/assets/js/16.976ac738.js"><link rel="prefetch" href="/assets/js/17.403f7719.js"><link rel="prefetch" href="/assets/js/18.92c074ba.js"><link rel="prefetch" href="/assets/js/19.979680c0.js"><link rel="prefetch" href="/assets/js/20.12c24125.js"><link rel="prefetch" href="/assets/js/21.75236644.js"><link rel="prefetch" href="/assets/js/22.99db2e15.js"><link rel="prefetch" href="/assets/js/23.b5999731.js"><link rel="prefetch" href="/assets/js/24.0d1a4624.js"><link rel="prefetch" href="/assets/js/25.1524be97.js"><link rel="prefetch" href="/assets/js/26.f9d1c2bf.js"><link rel="prefetch" href="/assets/js/27.13235d74.js"><link rel="prefetch" href="/assets/js/28.8e5be585.js"><link rel="prefetch" href="/assets/js/29.49595657.js"><link rel="prefetch" href="/assets/js/3.24073063.js"><link rel="prefetch" href="/assets/js/30.01cb4de1.js"><link rel="prefetch" href="/assets/js/4.57ba7ae3.js"><link rel="prefetch" href="/assets/js/6.7222ed7b.js"><link rel="prefetch" href="/assets/js/7.918a646b.js"><link rel="prefetch" href="/assets/js/8.564e1d40.js"><link rel="prefetch" href="/assets/js/9.6b6163c2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f2124281.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Anji博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>入门</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ajax</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>jQuery</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue/MVVM/" class="sidebar-link">MVVM框架模式</a></li><li><a href="/vue/bind/" class="active sidebar-link">vue双向数据绑定</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vue/axios/" class="sidebar-link">axios请求数据</a></li><li><a href="/vue/vuex/" class="sidebar-link">vuex</a></li><li><a href="/vue/ui/" class="sidebar-link">常用的ui库</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><strong>什么是双向数据绑定？</strong></p> <p>Vue 是一个 MVVM 框架，数据绑定简单来说，就是当数据发生变化时，相应的视图会进行更新，当视图更新时，数据也会跟着变化。</p> <p>Vue.js 则是通过数据劫持以及结合发布者-订阅者来实现的，数据劫持是利用 ES5 的 Object.defineProperty(obj, key, val)来劫持各个属性的的 setter 以及 getter，在数据变动时发布消息给订阅者，从而触发相应的回调来更新视图。</p> <h3 id="_1-实现最基础的数据绑定"><a href="#_1-实现最基础的数据绑定" aria-hidden="true" class="header-anchor">#</a> 1.实现最基础的数据绑定</h3> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;inp&quot;</span><span class="token operator">&gt;</span>
        输入的值为：<span class="token punctuation">{</span><span class="token punctuation">{</span>inp<span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;inp&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MVue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
            data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                inp<span class="token punctuation">:</span> <span class="token string">'hello world'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p><strong>实现思路：</strong></p> <p>1、输入框以及文本节点和 data 中的数据进行绑定</p> <p>2、输入框内容变化时，data 中的对应数据同步变化，即 view =&gt; model</p> <p>3、data 中数据变化时，对应的文本节点内容同步变化 即 model =&gt; view</p> <p><strong>双向数据绑定原理图</strong></p> <p><img src="data:image/png;base64,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" alt="An image"></p> <h3 id="_2、实现-compile"><a href="#_2、实现-compile" aria-hidden="true" class="header-anchor">#</a> 2、实现 Compile</h3> <p>compile 主要做的事情是解析模板指令，将模板中的变量替换成数据，然后初始化渲染页面视图，并将每个指令对应的节点绑定更新函数，添加监听数据的订阅者，一旦数据有变动，收到通知，更新视图，如图所示:</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAnEAAAEDCAMAAABtUaJdAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAADNQTFRF///t5ffsZWVkqa6pMjIy5ublx8rA////8/Pz6//12+/ll5eR1t3Ufn54AAAAUFBP5OTcxZkbIwAAFoRJREFUeNrtnYmioygQRRMtiR3xxf//2hZkqUJN3M1ymXmJKFc0nq5iEy63EMqbCIWMlnOi0EI7Fr283RVB+91aEAftsVoQB+2x2ks5FopyeYAW2rEAGwftsVoQB+2xWhAH7bFaEAftsVoQB+2xWhD301ryMSpZjERiYmGDfEHcj2qp00bkZKSMiFHUgjhol2spWi+L2E1YsZJ8Is4iiIN2hZY4R96r2u02lBSjbheBOGg31kamEuJIHgVx0M7WktUyR0rcfdJNEEfyKIiDdoGWpLa1YhYnck408aoluaPrrxnE/ayWmI0jX1W42eIa3Uh6Vf+3Qb4g7me1niDyR2NznPSqRJ2N26g9rgihLJ6Fck4U2vfXkvmzwX+Tj7bHSvNBIWHp0m+QL2zcr2pDTcDZOFdBcMfKW4g6jxqTwqtCu0BLsq7qy22hrnoLbhU1B2i30Iq6KlEox/GKBCMOrSPQbqDl/fOs5sAcKrG+MPTkQ/uRWhAH7bFaEAftsVoQB+2xWhAH7bFaEAftsVoQB+2xWhAH7bFaEAftsVoQB60NTaG1SaHyLihlEpTl5vlibqWf1xZaOcz09XrNQ/AxpXQxpl0QYON+Xqu8UVPXfyFc73cT8xYvV+VW+YK439UWOte3f/9aE9fSxWizxIWt+92awJKfAcRBO1tbdKZrALGh6F2bz9bTlquvGcT9pLbJ86rl7f5vInE2ereMNiuvGcT9oLa06FxfItaL3m25ToM4aOdp/7XVz3/3KYj1oldtaV1xzSDux7S68EWzRcR1hk6vuGYQ91PaIlYWFhNnqq//xNlBHLQjUVMMu68nzmg1M3QgDtrBqGkQ0ZyadcTFVmEQB+1QVMv66UribFtJs+CaQdyvaBVv792AuH9XlTvPCuKgHYgq5lE3Ia7zrLOvGcT9ivZ6/7c1cR65ecS97ygaaDfUXnvhfl0egvbeVh9mBti4X9AqPW6n1tg4c2DuNYO4H9C2zu+6E3FtAHHQJtGma/bdi7h/qplzzSDu67Wla/fdi7jWgs65ZhD39Vrl2uF2s3F50rMP4n5b29hC3J7E3bsx6ROvGcR9uzb0pe5G3D8lB8yBuJ/W6tC3tR9xrZErJl8ziPtyrQ7Dk/Yj7iqNHIj7be11IjVriLuKkhyI+2ntZGrWECdLciDup7XHEHdVsHHQmqjW18nUrCHO9HVNvGYQ99Vald9nULOGuH9Trxmjlb5am+f3lyOO1oxWYmHqNcPGfbO2yPMxO3V31s/PqBSP2j0+2k04MsHGqXziNYO4b9Zq/mrDEuKuamqfrIqNwCDud7Xi3Ya9idPTrhnEfbOWVxzGibvmWrneV+1mLjTvabV77ByZVzvBjTb4afeCNYiDdjixHzbyiriWJ22YMrC1nvh6NRt3g5yxcXczQWu70WLYVhlGiNOxDRjE/a6WVxyeEafMpElm424d6fXuNjrizHdr7u7exQ4Sdwdx0E4kroXJuMx2x92aRFuOu2v7RnVHnba9CvqqNIiD9mlipaYRd++I05Y4Y+xUrvTd2bhrmPscxEH7KvG/UeKuA8QFGye8qjGB167iCuKgfZH4GXHaf3VelZfjtJkh+Jr3ynEgDtoXiceJ6yqntlJ6NW0eNqpdXbWrpuaqK9S5uur1KXHXopl2zSDuq7XX0dYRs06DLZxZY6ZcQ5tvjzOz/eqONtceZxvpnhDHuvJB3O9qn/Q58JkcrLUbgui1Nh6des0g7pu1zXi/6nnEFSGUxbNQzolCe5K2emRZVldVZZfSKnTVVkB9uN7HQq56R59H7/2jeT7xmmHjvkqrSYaMdXPtOiKTdXLBq/6UVgKX84LcrsSpyVOfg7jv0taMt0chBsjtShx/fRDE/Yy2UNUjAmderyrZ6JFd3+Xi8yuBuJ/QloI2oqq0iZlbxfuq0G6lDbRllXIO1U8I3cThI3gnH9ottJw2c9QW5KqYOK6hinlHoF2tzSNt/mjexgqReH/ikgnkQNxHaScHVWWcNn9mTekYjgOI05g/7lO1dOvFiMX8tqftUfUfdb+VQu88R+a/65z7BXHvpSXfiOsiQ8QF2spJ+eq95wH+N+t+Qdw7aTvUDFcBNg6c++tom56vWwJuL+IUiPtobSTO4heho3Awzpw1Ld9i1/UcVDLvNIj7LC2JP4oulvyeBfl2LzbvQ1x77mIecZ83X9D3aj1ljDiPodtrd8zPVw3MsbTN3EotcHre/cLGvZVWlOOCjesO3dKq7Ix8LXI72DhtVw+BV/1YLXEbFy2bO+ZM3KJ8/YsM2xK3aH3Vt34Cv6ftleNukThabuPMgpfb27gW42b2/YK499ISb4XjLSWCxWX5bk3c1QEH4j5ZS6Ipbqgct5y42z9135K4m6+kgriP1Oq8vok6ab8c55uIl+bbvXa6CXFXPfnlLRD3htqWtoSlaWFuvvbF5y2IUzMGxIG4N9OqjjZ61MnCuBPC7HxLFZhbQZy27yYuvF8Qd6ZWR9oWDVpakG9jJua6ryDONPpWqpibbwgg7iztCG37X3PT9ewvI85OECyXUwVxH6DltJ1wzU1bbf2n9SLiWtyKVb8VJ6504/zODI8sX3E3T3+JE26vuxl5GbqStu20EestO+OrdvWjZoK5f5bWdfky4orHyt93o1Dt8wTKU26vFpcx5ElPq7F0/tE30T0l7qptYr1Fvoy4iigvLieHpr0Kvfhunv0SJ9xekZN566Acpe1M4opb2XFkXi+8XseJu3epctWUW+TLRitlpM7mzYSaql1GDZ1yexXVdrSQfy+h7o/tOXeUVAudKktT/7RzFWptBiLdtQlt1EyO6Y41W+XLbBzR2bDZkFtPtP2/+VNuT1FW5Jm0be9Y2ylyH2w1NsaMrim3zPf9iGsf0i5P4CTi+p70HYlrjxaFtWttkcZaN2PvmjC6F8QteAJnEddr3X1T4uJmVe2ZL4jb/2bepx1wmvbxAHFbPAEQN1GrTWsBiFv/BIZuj9if/0yPyT1ik8ZSfjRxlWkSBXHrn8B04oj4/qAjnqDd231+H3GPtuwJ4jZ4AiPE+c4BFmM0UlQJrvo2jif9aOLs5NUaxK1/Av3b6yCJtoyIIcWiwZD5TWbjiOm+g7jK9jSCuPVP4LmN8zFxjGFGCXh0iW52HLhPJM52Pz9A3PonMEZcgKrPHzNnbM+F4Tag+3Di3IoQeol2UvSniYu+kXyMc5QKKPn228T+/3ji8qEBPCBuyS8xSJyviVKIReKC6XJwMjOWxr6IODem67Fbvr9MHAl/6LCJldbLZaB8lrSjXFzKryGu8P+WduuZY6OV3oe4XUbvjLXHCX6I1wcGiKNLqujIpZGC3ISbeYM5nViowrjYvfL9ZRuXsjJAXIKRaAKOXtWdauxmPsnGhYHSj/naadFfJ46zIls5EhsnW+vEt+y5+GjiglNN3CqIW/BLTOnlkq1sqVelceKGOmY/kTj3S2HsyBZPYMyrRpi62unF1VoHvaq3f9wXM+NHgzcD4nj4beKOuRkQxwOIA3HpURC3zRMAcVO1IG5x+DXi3jNsTZyuiR7563RFpi55LXZV6lL33yEdJu7P/JngIzbqImxn/L5NJi5tSqOBrf6IuMvIsbOJ4/No0sCxuEnD6q5ONHyC/rnSaTvZfAT7EJc/WmZ0VpeTEgviVG147b0mP0Lc35+Ay+EWiGPRv/A0JhM31JOVECb6sWTv2Ggf1wnEkZihmvGTkjBCHJtoPUVUnKD75ifzB4JqH+L0Q3VfE6xcQpwxeq2d6wkHiftj/8fvcCjw1tlCu1WRnALwKXH2a2CcEu90ZY28JBt/aawB+A1sHFtNLrV+QytE+N+KYcangqV+XslyThG+JcTldf6gTBukMnpUl0vd/pVZ+9HYvS0wjiHVtPta/1o3QdV+tAZMZ6qVKuZV/SlVVoTPV8T9cVNmfWswaSHC/W1HXBtq9eT2Eqo6gpjp6iX0A4XF8GB57GTiiBgjYZOtsESSvkHHGi0hX1siGrmoZ8vUxaUAKDn3LOJMf27dekxjw5q6vuSZ2W53OFDKLJqopkWyrLLGqpqMqhbLqk3d4qbaP0+cSWHill6jUkMPKf2NQxHOE/UnCnUu8heM4J8jzkDnZqwdIk58RfMmPzxzzLYlYzfFsZNtHBF73CTMnKBHEsPl1EucLjMRYGT8ieWdiJvPWcQ9WpOlHrozZS0cZjvPWmYqi0uLUSSuMhCaHVZV2Y/a+dt2wxHXuWEbt9KyzoceUo+48N8tgPUX8BPBx8MoCAfdU+IEMsl7DcxzcuJYmncZH3fzJoZZMlGIZ6k8dkMnSKoOAzbO29LgVyNxMcEIcUUIA8S1Js0Q19HRGjSDTaUy1ZXBJHGdzaqMISxckc0S5zyoI87iaOKuBOjZFQ+JkuCNmDNrzpF64v6iwfv7C5vJKbJ8zKtyjiRUkS33vy+xCeLSY+nNFEVZiJBEi6dHZ2mZsWEksNJWj6Rg2CSMCWNDNo77Veu8hY2ze4ev+UU57uKI63LOW6yKuqlznTWX1EJ1mz3isoQ4NxamCcTV/Yc0QJz5789XDHgl4i9tHXGbySnqfMTGUd+4ya8EQD8+mPesimPn2jjvQoNzk0UvzguNETfBxvm6auQuXdJpac3hwmxcZ/VUbaoGHhPPS1UXz2xcHonzNYVnNq7/Gwcj5okSXvWvV8y7TfaqbESc68aXqLFCWzCDJGycOHYyccEkydXjhuqqvBQ3YuMSi5cmTOshxLNcR9ylduU40/KWt3sCgY6bpi2txXKcJE6W41RHYF0uKseFykKkT7YA/0USJ9YcxBjMpBwnC3R9HNNy4PnEyaW8EsMTms9uCUKiBdcZLFb1EPUDQewwcQLzhcSplpu2Hlpe7EyTzeOhQ5LQAhzrqpK4TNtT+LpqndRVs2l1VUFZjzhm4/5EzeFF6winLvGgkjiiPn/BtiWe91TiZC1UrOwVl6K+DRqteEBERFFQgt2rEw+0NC8kzrTHUWX8oa2D1lnsYoi9XKY9rmouKXFVZtvfeHucNYwz2+Nu3KuKvq60HPc3uQWYoh+lHmOMSs8cI07WVke7uY73qqwRTawPzBp1A1jDtVhZX2CnlqXCdCXOkHvK7sE9+foxNvtuV9+tp/U5LAgTern4Cw1pb2rSVkckvaosyb2PV33D8DbEzetXXX+vQ28Ppp8dP97DhhDeyXdgeW9KYdTwWEcXiHsn4maNHVl/rxitdFL48PFxGJG5vxYjMrd5AiBuqhbEbfMEQNxULYjb5gksvL11PwqIA3ELiGMDk0Dc6nxB3ATi/AaI2yDf355b6TVvJGcD3uFm3mtupe6X2jNf2LhXzMGrbpsviJtA3GVxBQLEgTgQ91IL4rZ5AkuJE8N9QdzqfEHcC95g4zbOF8S9Yg7EbZsviJtCHOqq2+UL4l4St8bKgTgQB+JeakHcNk9geZ/DBV4VxC34JTBaaaoWxG3zBEDcVC2I2+YJgLipWhC3zRMAcVO1GK20zeidk4ijWu838sdpe1MDvVfIx0YrPag5mzYTKrma7Gb/5jOaNHPs1jdDZsqCcuE1T7zfs5F6EeTqwIw4M63lG4QH5dN/8hlPL2//sen1lzcnqBa4vDY/Op+QYg/izn5oT0I1TpzxALk6OVQPonL6Tz7n6T3W/ltd+u/bQacWXPN3E1fmZ5vfLqgZP/msp5dnB0OXdZSV7U9rcn5UBYgTxN2KqspODlWu1z+Bd9QWlYUuL0DcBz69D9VqV6QrF2if5gvioB2LKlmk2yhfEAfteNQX6fQCLYiDdpE2Fuk2yhfEQfsqyop0IO7jnt6Ha2cFEAftcm1/RQ8TQowdjNM5gzhol2vjVPQ+dktmq+fLfTzLF8RBOyHaX/o2kkWDq33cTiSuLJYqe8TtOYoG2vEQV/egdAkEu4utuhAOjeW7mrhuAvB0bQ2+AHN/ivCmLkqzfMcE4sQ1w8adpRXLbfAFdG9s4TWWzCbZycYtIa5SZnDMJOLENYO407SiHEduFRgSNYZbTPos39fEFZlZ0ru1SIVZWKi0C7cYoIpuPY1AXJeusAsQZWaZP7NYUaYvtVl40mmLuqL6ouvSrKqmXuUM4t5G69e8ooESnVhtnLve5cTVTVlXduG90qwP6VdIq6SNK7KsKd16y/pR22XTSrMOYK2Ctsja81wqO741f23kQNy7aOMyuGwZLc9Yf1HAtcQpa9SUsUxN1uisaOpaWdcoiVP2uAprqznv2qbwWpumzAYdMYh7cy33qnL109tgnWI1cd0QSLNirlZVnhfG0UriukX7ujUA7UdVPzriotZSacdTdws2g7gP0fI1SokGGuf6K/qtJi4sxZznua59yX+UuCbLcu1snNfacznUChD3OVq/MOVgOU7aONqg5uC8qltuvqWp1m0VQHn+nPdMvar1pN6rOi1s3AdrY7MHi/MWkXBgI69aZm1l06DTPFqm6ofnr1uXOe9qGFVXwzA1B/Uw6y9npa05OC3KcR+unRXWEmeXXbaFN1MBjQ1uyjSCKJOuepgWkNA6kpvxo2ZhcKq8tlsYF3XVj9XOCnv3chXZ6wa2Lmhj3cr69fuYIO7dtLPC+xCHPoev1ir/mrU/WtQl055CnOlXdY0rIO4btfI164oe+rYDcTsEEPexWv6atdnKP5S4IoSyeBbKOVFo99GquoNO2ca62u9+d+LEPcDGfZi2K9J14eF87CBxQ7NlE19GkS78azD0zkHPUvIsBHHiFkDc52nzCF2HXJ+4gfnZTfJ4iDhx7mSjxLGDxM4WQjgwdBIQ9wVaFR+2fZrjxFkeOiiiFepWDODEjdgvD1tcRYUknAl/gyYQxH2BljlWyspx4mggEg1apHGcOGYQKTm9wI8uIg8Q913aUpibhx4jziNACQ0BEpL09E7ibeMQS5R+jK2yAuI+X5vO85ePelVufKJt47br+VJ3ncwbOFlu4zYueNUBcEHc92iVslOa5tVoXVUQl/AXOBonLh4neda+jUtAB3HfrX3RHkcJVqF454zV2JLFQ151lDhOL4j7du0AcUmxntu4uJteL1kc66pJsmGvCuJ+QztEHF81McEqRIa8at/S9Xnl/rrvgUHc92tfESexCo1zjD8Gkmw1HigFxixIbBOI+xntC+KSclevs0taOd6K4s8UuxVSHqUdBHE/op1JHPnGs9iS1qtWCG+ZoMnsn4BuuDwI4r5QO1jLlD1SrOwlWmx9LUJ0jybAxY94ztjRRQG9wRNgbqVv1L77aCVxzbBxX6B9d+LENYO4L9CCOGiP1YI4aI/VbkHc4Mi3LUgGcV+o3c7G8U4JAnHQ7mnjImq9YcIgDlqpXU8cif/lMGEQB22q3YQ4YdjkMGEQB63UbkOc7NrfrCQH4r5Qu7WNS4cJgzhopXbrclw6TBjEQSu1WxAXx35QMkwYxEGbajcvxyXDhEEctFK7UTkuDmwaH3u0AXHvOgIH2unarWwc2xbD6tYSJ64ZNu4LtBsQlwzhlMOE1xInrhnEfYF227EjlAwTBnHQplqMVoL2WC2Ig/ZYLYiD9lgtiIP2WC2Ig/ZYLYiD9lgtiIP2WC2Ig/ZYLYiD9lgtkXrfUIO479PSewcQ93XaPHvroMU1Y7QStMdqYeOgPVYL4qA9VgvioD1WC+KgPVYL4qA9VgvioD1WC+KgPVYL4qA9VgvioD1WC+KgPVYL4qA9VgvioD1WC+KgPVYL4qA9VvsfJW+tF3H5JicAAAAASUVORK5CYII=" alt="An image"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> reg <span class="token operator">=</span> <span class="token regex">/\{\{(.*)\}\}/</span><span class="token punctuation">;</span>
  <span class="token comment">// 元素节点</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> attrs <span class="token operator">=</span> node<span class="token punctuation">.</span>attributes<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> attr <span class="token keyword">of</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>attr<span class="token punctuation">.</span>nodeName <span class="token operator">===</span> <span class="token string">'v-model'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取v-model指令绑定的data属性</span>
        <span class="token keyword">var</span> name <span class="token operator">=</span> attr<span class="token punctuation">.</span>nodeValue<span class="token punctuation">;</span>
        <span class="token comment">// 绑定事件</span>
        node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          vm<span class="token punctuation">.</span>$data<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 初始化数据绑定</span>
        node<span class="token punctuation">.</span>value <span class="token operator">=</span> vm<span class="token punctuation">.</span>$data<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 移除v-model 属性</span>
        node<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'v-model'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 文本节点</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> name <span class="token operator">=</span> RegExp<span class="token punctuation">.</span>$<span class="token number">1</span> <span class="token operator">&amp;&amp;</span> RegExp<span class="token punctuation">.</span>$<span class="token number">1.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 绑定数据到文本节点中</span>
      node<span class="token punctuation">.</span>nodeValue <span class="token operator">=</span> node<span class="token punctuation">.</span>nodeValue<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'\\{\\{\\s*('</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">')\\s*\\}\\}'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        vm<span class="token punctuation">.</span>$data<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改下 MVue 构造函数，增加模板编译:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">MVue</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$el <span class="token operator">=</span> options<span class="token punctuation">.</span>el<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$data <span class="token operator">=</span> options<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

  <span class="token comment">// 模板编译</span>
  <span class="token keyword">let</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  elem<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">nodeToFragment</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-实现-watcher"><a href="#_3-实现-watcher" aria-hidden="true" class="header-anchor">#</a> 3.实现 watcher</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Watcher</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> node<span class="token punctuation">,</span> name<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>node <span class="token operator">=</span> node<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Watcher</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">update</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>node<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 订阅者执行相应操作</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 获取data的属性值</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//触发相应属性的get</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-实现-dep-来为每个属性添加订阅者"><a href="#_4-实现-dep-来为每个属性添加订阅者" aria-hidden="true" class="header-anchor">#</a> 4.实现 Dep 来为每个属性添加订阅者</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Dep</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">addSub</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">notify</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sub<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/vue/MVVM/" class="prev">
          MVVM框架模式
        </a></span> <span class="next"><a href="/vue/axios/">
          axios请求数据
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d2db35b1.js" defer></script><script src="/assets/js/2.3d65a9bd.js" defer></script><script src="/assets/js/5.838622a9.js" defer></script>
  </body>
</html>
